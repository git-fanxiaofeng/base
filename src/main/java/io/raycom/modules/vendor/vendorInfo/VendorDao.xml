<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="io.raycom.modules.vendor.vendorInfo.VendorDao">	
	<!-- 查询所有供应商信息 -->
	<select id="queryVendorList" parameterType="page" resultType="rdata" >
		SELECT row_number() over(order by va.update_date desc, va.create_date desc)	"num",
               va.vendor_id                                      "vendorId",
               va.vendor_ch_name 				                 "vendorChName",
               va.vendor_ch_short_name 			                 "vendorChShortName",
               va.vendor_category								 "vendorCategory",
               va.create_date 					                 "createDate",
               va.del_flag 						                 "delFlag"           
		FROM   tb_uhq_vendor va
		WHERE  va.del_flag ='N'
		<if test="param.vendorName!='' and param.vendorName!=null">
		 AND (upper(va.vendor_ch_name) like '%' || upper(trim(#{param.vendorName})) || '%' 
			     OR upper(va.vendor_ch_short_name) like '%' || upper(trim(#{param.vendorName})) || '%' 
			     ) 
		</if>
		<if test="param.status!='-1' and param.status!=null and param.status!='' ">
			AND va.status = trim(#{param.status})
		</if>
		ORDER BY va.update_date desc, va.create_date desc
	</select>
	
	<!-- 获取供应商基础信息 -->
	<select id="queryVh" resultType="rdata" parameterType="rdata">
	 	SELECT 
		       v.vendor_ch_name 				"vendorChName",
		       v.corporation 					"corporation",
		       v.registered_fund 				"registeredFund",
		       (select nation_name from com_nationcode where nation_code = v.nation) ||
		       f_get_com_dict_name(v.area, 'state') "area",
		       v.registered_address 			"registeredAddress",
		       f_get_com_dict_name(v.company_type, 'companyType') "companyType",
		       v.office_address 				"officeAddress",
		       v.introduction 					"introduction",
		       v.tolerance_range 				"toleranceRange",
		       v.contact1 						"contact1",
		       v.tel1 							"tel1",
		       v.email1 						"email1",
		       v.contact2 						"contact2",
		       v.tel2 							"tel2",
		       ve.hos_name 						"hosName",
		       v.email2 						"email2"
		  FROM tb_uhq_vendor v,tb_uhq_hos ve
		 WHERE v.vendor_id = #{vendorId} 
		   AND v.hos_id	= ve.hos_id
		   AND v.del_flag = 'N'
	</select>
	
	<!-- 查询供应商资质 -->
	<select id="queryVhCert" parameterType="rdata" resultType="rdata">
		select 
			   nvl(vcud.mst_id,'-1')           	 			"certUnitMstId",
	           nvl(vcud.company_name,'其他'）            		 		"certUnitMstName",
	           vcud.dtl_id                     	 			"certUnitDtlId",
	           c.company_name            		 	 		"companyName",
	           c.certificate_id								"certificateId",
	           c.agency_order                     	 		"agencyOrder",
	           c.vendor_id                             		"vendorId",
	           c.vendor_name								"vendorName",
	           c.certificate_type                      		"certificateType",
	           f_get_com_dict_name(c.certificate_type, 'certificateType') "certificateTypeName",
	           c.certificate_name                      		"certificateName",
	           c.certificate_no                       	    "certificateNo",
	           to_char(c.start_date, 'YYYY-MM-DD')     		"startDate",
	           to_char(c.close_date, 'YYYY-MM-DD')     		"closeDate",
	           c.issue_dept									"issueDept",
	           c.attach_id									"attachId",
	           c.manufacture_name							"manufactureName",
	           c.authorized_name							"authorizedName",
	           c.cert_parent_category						"certParentCategory",
	           c.cert_iden									"certIden"
	      from 	(
	      		 select    vcum.mst_id,
		                   vcum.company_name,
		                   vcud.dtl_id
	              from tb_uhq_ven_cert_unit_mst vcum, 
	                   tb_uhq_ven_cert_unit_dtl vcud
	             where vcum.mst_id = vcud.mst_id
	               and vcum.del_flag = 'N'
	               and vcud.del_flag = 'N'
	               and vcum.vendor_id=#{vendorId}) vcud, 
	      		 tb_uhq_vendor_cert  c
	     where c.del_flag = 'N'
	       and c.vendor_id=#{vendorId} 
	  order by vcud.mst_id,c.cert_parent_category,c.company_name
	</select>
	
</mapper>